<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="dist/coloris.min.css" />
    <script src="dist/coloris.min.js"></script>
    <script src="dist/html2canvas.min.js"></script>
    <title>PID Maker</title>
    <style>
      body {
        margin: 0;
        background: rgb(31, 31, 31);
        color: rgb(179, 179, 179);
        --text-stroke-width: 0.5px;
        font-family: "Arial";
        text-shadow: calc(var(--text-stroke-width) * -1)
            calc(var(--text-stroke-width) * -1) 0 #000,
          var(--text-stroke-width) calc(var(--text-stroke-width) * -1) 0 #000,
          calc(var(--text-stroke-width) * -1) var(--text-stroke-width) 0 #000,
          var(--text-stroke-width) var(--text-stroke-width) 0 #000;
      }
      button,
      input {
        background-color: rgb(31, 31, 31);
        color: rgb(179, 179, 179);
        border: solid black 1px;
      }
      .container {
        aspect-ratio: calc(16 / 9);
        height: 355px;
        width: 680px;
        background-color: black;
        color: white;
        font-weight: bold;
      }
      .lmr {
        height: 25px;
        font-size: 21px;
        display: flex;
        padding-left: 3px;
        padding-right: 3px;
        position: relative;
      }
      .margin {
        height: 25px;
      }
      .lmrmiddle {
        margin-left: auto;
        margin-right: auto;
      }
      .lmrleft {
        position: absolute;
      }
      .time {
        color: yellow;
      }
      .lmrright {
        position: absolute;
        right: 3px;
      }
      .service-table {
        font-size: 24px;
        width: 100%;
        border-collapse: collapse;
      }
      .service-table tr {
        height: 40px;
        border-top: 3px solid black;
        background-color: #00871c;
      }
      .service-table td:nth-child(1) {
        width: 70px;
      }
      .service-table td:nth-child(2) {
        width: 332px;
      }
      .service-table td:nth-child(3) {
        width: 60px;
      }
      .service-table td:nth-child(4) {
        width: 79px;
        text-align: center;
      }
      .service-table td:nth-child(5) {
        width: 29px;
        position: relative;
      }
      .ngr {
        position: absolute;
        top: 3px;
      }
      .tcar {
        position: absolute;
        top: 3px;
        width: 30px;
      }
      .service-table td:nth-child(6) {
        text-align: right;
      }
      .service-table .header-row {
        background-color: black;
        position: relative;
        width: 100%;
        height: 22px;
        font-size: 19px;
      }
      .platform {
        font-size: 28px;
      }
      .service-table th:nth-child(1) {
        position: absolute;
      }
      .service-table th:nth-child(2) {
        position: absolute;
        right: 130px;
      }
      .service-table th:nth-child(3) {
        position: absolute;
        right: 0;
      }
      .inactive {
        opacity: 0;
      }
      .hidden,
      .hidden .active,
      .hidden .inactive {
        cursor: default;
        user-select: none;
      }

      .inactive,
      .active,
      button {
        cursor: pointer;
      }

      button[disabled] {
        cursor: default;
        color: rgb(63, 63, 63);
      }

      .inactive:hover {
        opacity: 0.3;
      }
      .active:hover {
        opacity: 0.7;
      }
    </style>
  </head>
  <body>
    <div class="hide">
      <h1>SysPoe's Passenger Information Display Maker!</h1>
      Please excuse the NGR logo. It's traced from a really bad photo I took.
    </div>
    <div class="container">
      <div class="lmr">
        <div class="lmrleft time" contenteditable="true" spellcheck="false">
          8:59:55
        </div>
        <div class="lmrmiddle" contenteditable="true" spellcheck="false">
          Next (1-6) Trains South & West
        </div>
        <!-- <div class="lmrright">Departs</div> -->
      </div>
      <div class="margin"></div>
      <table class="service-table">
        <tr class="header-row">
          <th>Service</th>
          <th>Platform</th>
          <th>Departs</th>
        </tr>
        <tr id="tr1">
          <td contenteditable="true" spellcheck="false">9:01</td>
          <td contenteditable="true" spellcheck="false">Ipswich</td>
          <td contenteditable="true" class="active">Exp</td>
          <td contenteditable="true" spellcheck="false" class="platform">5</td>
          <td class="active">
            <div class="ngr"><img src="./NGR.svg" /></div>
            <div class="tcar" style="display: none">
              <img src="./3car.svg" />
            </div>
          </td>
          <td contenteditable="true" spellcheck="false">2 min</td>
        </tr>
        <tr id="tr2">
          <td contenteditable="true" spellcheck="false">9:01</td>
          <td contenteditable="true" spellcheck="false">Ipswich</td>
          <td contenteditable="true" class="active">Exp</td>
          <td contenteditable="true" spellcheck="false" class="platform">5</td>
          <td class="active">
            <div class="tcar" style="display: none">
              <img src="./3car.svg" />
            </div>
            <div class="ngr"><img src="./NGR.svg" /></div>
          </td>
          <td contenteditable="true" spellcheck="false">2 min</td>
        </tr>
        <tr id="tr3">
          <td contenteditable="true" spellcheck="false">9:01</td>
          <td contenteditable="true" spellcheck="false">Ipswich</td>
          <td contenteditable="true" class="active">Exp</td>
          <td contenteditable="true" spellcheck="false" class="platform">5</td>
          <td class="active">
            <div class="ngr"><img src="./NGR.svg" /></div>
            <div class="tcar" style="display: none">
              <img src="./3car.svg" />
            </div>
          </td>
          <td contenteditable="true" spellcheck="false">2 min</td>
        </tr>
        <tr id="tr4">
          <td contenteditable="true" spellcheck="false">9:01</td>
          <td contenteditable="true" spellcheck="false">Ipswich</td>
          <td contenteditable="true" class="active">Exp</td>
          <td contenteditable="true" spellcheck="false" class="platform">5</td>
          <td class="active">
            <div class="ngr"><img src="./NGR.svg" /></div>
            <div class="tcar" style="display: none">
              <img src="./3car.svg" />
            </div>
          </td>
          <td contenteditable="true" spellcheck="false">2 min</td>
        </tr>
        <tr id="tr5">
          <td contenteditable="true" spellcheck="false">9:01</td>
          <td contenteditable="true" spellcheck="false">Ipswich</td>
          <td contenteditable="true" class="active">Exp</td>
          <td contenteditable="true" spellcheck="false" class="platform">5</td>
          <td class="active">
            <div class="ngr"><img src="./NGR.svg" /></div>
            <div class="tcar" style="display: none">
              <img src="./3car.svg" />
            </div>
          </td>
          <td contenteditable="true" spellcheck="false">2 min</td>
        </tr>
        <tr id="tr6">
          <td contenteditable="true" spellcheck="false">9:01</td>
          <td contenteditable="true" spellcheck="false">Ipswich</td>
          <td contenteditable="true" class="active">Exp</td>
          <td contenteditable="true" spellcheck="false" class="platform">5</td>
          <td class="active">
            <div class="ngr"><img src="./NGR.svg" /></div>
            <div class="tcar" style="display: none">
              <img src="./3car.svg" />
            </div>
          </td>
          <td contenteditable="true" spellcheck="false">2 min</td>
        </tr>
      </table>
    </div>

    <div class="hide">
      <button onclick="takeshot()">Screenshot</button><br />
    </div>

    <div class="hide">
      <div class="hide-buttons">
        <button id="hide1" onclick="hide(1)">Hide #1</button>
        <button id="hide2" onclick="hide(2)">Hide #2</button>
        <button id="hide3" onclick="hide(3)">Hide #3</button>
        <button id="hide4" onclick="hide(4)">Hide #4</button>
        <button id="hide5" onclick="hide(5)">Hide #5</button>
        <button id="hide6" onclick="hide(6)">Hide #6</button>
        <button onclick="for(let i = 1; i <= 6; i++) hide(i, '0');">
          Hide All
        </button>
        <button onclick="for(let i = 1; i <= 6; i++) hide(i, '1');">
          Show All
        </button>
      </div>

      <div class="tcar-buttons">
        <button id="tcar1" onclick="car3(1)">3car #1</button>
        <button id="tcar2" onclick="car3(2)">3car #2</button>
        <button id="tcar3" onclick="car3(3)">3car #3</button>
        <button id="tcar4" onclick="car3(4)">3car #4</button>
        <button id="tcar5" onclick="car3(5)">3car #5</button>
        <button id="tcar6" onclick="car3(6)">3car #6</button>
        <button onclick="for(let i = 1; i <= 6; i++) car3(i, '0');">
          3car All
        </button>
        <button onclick="for(let i = 1; i <= 6; i++) car3(i, '1');">
          NGR All
        </button>
      </div>

      <div class="select-station">
        <input list="station-list" placeholder="Loading stations..." />
        <datalist id="station-list"> </datalist>
        <button onclick="updateStationSW()">South & West (WIP)</button>
        <button onclick="updateStationNE()">North & East (WIP)</button>
        <button onclick="updateStationAll()">All trains (WIP)</button>
      </div>

      <div class="color">
        <div>
          <label for="colsel1">Select color for #1: </label
          ><input name="colsel1" id="colsel1" type="text" data-coloris />
        </div>
        <div>
          <label for="colsel2">Select color for #2: </label
          ><input name="colsel2" id="colsel2" type="text" data-coloris />
        </div>
        <div>
          <label for="colsel3">Select color for #3: </label
          ><input name="colsel3" id="colsel3" type="text" data-coloris />
        </div>
        <div>
          <label for="colsel4">Select color for #4: </label
          ><input name="colsel4" id="colsel4" type="text" data-coloris />
        </div>
        <div>
          <label for="colsel5">Select color for #5: </label
          ><input name="colsel5" id="colsel5" type="text" data-coloris />
        </div>
        <div>
          <label for="colsel6">Select color for #6: </label
          ><input name="colsel6" id="colsel6" type="text" data-coloris />
        </div>
      </div>

      <br />
      <div class="color-select">
        Colors:
        <ul>
          <li>
            <button onclick="setColor(1, '#00871C')">Set #1</button>
            <button onclick="setColor(2, '#00871C')">Set #2</button>
            <button onclick="setColor(3, '#00871C')">Set #3</button>
            <button onclick="setColor(4, '#00871C')">Set #4</button>
            <button onclick="setColor(5, '#00871C')">Set #5</button>
            <button onclick="setColor(6, '#00871C')">Set #6</button>
            #00871C Ipswich / Sunshine Coast
          </li>
          <li>
            <button onclick="setColor(1, '#E31837')">Set #1</button>
            <button onclick="setColor(2, '#E31837')">Set #2</button>
            <button onclick="setColor(3, '#E31837')">Set #3</button>
            <button onclick="setColor(4, '#E31837')">Set #4</button>
            <button onclick="setColor(5, '#E31837')">Set #5</button>
            <button onclick="setColor(6, '#E31837')">Set #6</button>
            #E31837 Beenleigh / Ferny Grove
          </li>
          <li>
            <button onclick="setColor(1, '#1578BE')">Set #1</button>
            <button onclick="setColor(2, '#1578BE')">Set #2</button>
            <button onclick="setColor(3, '#1578BE')">Set #3</button>
            <button onclick="setColor(4, '#1578BE')">Set #4</button>
            <button onclick="setColor(5, '#1578BE')">Set #5</button>
            <button onclick="setColor(6, '#1578BE')">Set #6</button>
            #1578BE Springfield Central / Redcliffe
          </li>
          <li>
            <button onclick="setColor(1, '#00467F')">Set #1</button>
            <button onclick="setColor(2, '#00467F')">Set #2</button>
            <button onclick="setColor(3, '#00467F')">Set #3</button>
            <button onclick="setColor(4, '#00467F')">Set #4</button>
            <button onclick="setColor(5, '#00467F')">Set #5</button>
            <button onclick="setColor(6, '#00467F')">Set #6</button>
            #00467F Cleveland / Shorncliffe
          </li>
          <li>
            <button onclick="setColor(1, '#FFC425')">Set #1</button>
            <button onclick="setColor(2, '#FFC425')">Set #2</button>
            <button onclick="setColor(3, '#FFC425')">Set #3</button>
            <button onclick="setColor(4, '#FFC425')">Set #4</button>
            <button onclick="setColor(5, '#FFC425')">Set #5</button>
            <button onclick="setColor(6, '#FFC425')">Set #6</button>
            #FFC425 Gold Coast / Airport
          </li>
          <li>
            <button onclick="setColor(1, '#A54399')">Set #1</button>
            <button onclick="setColor(2, '#A54399')">Set #2</button>
            <button onclick="setColor(3, '#A54399')">Set #3</button>
            <button onclick="setColor(4, '#A54399')">Set #4</button>
            <button onclick="setColor(5, '#A54399')">Set #5</button>
            <button onclick="setColor(6, '#A54399')">Set #6</button>
            #A54399 Doomben
          </li>
        </ul>
      </div>
    </div>
    <script>
      let zones = [
        {
          north: {
            display: "North",
            zones: [],
          },
          south: {
            display: "City & South",
            zones: [
              1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18,
            ],
          },
          order: 0,
          stations: [
            "gympie north",
            "traveston",
            "cooran",
            "pomona",
            "cooroy",
            "eumundi",
            "yandina",
          ],
        },
        {
          north: {
            display: "North",
            zones: [0],
          },
          south: {
            display: "City & South",
            zones: [2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18],
          },
          order: 0,
          stations: [
            "nambour",
            "woombye",
            "palmwoods",
            "eudlo",
            "mooloolah",
            "landsborough",
            "beerwah",
            "glasshouse mountains",
            "beerburrum",
            "elimbah",
          ],
        },
        {
          north: {
            display: "North",
            zones: [0, 1],
          },
          south: {
            display: "City & South",
            zones: [3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18],
          },
          order: 0,
          stations: [
            "caboolture",
            "morayfield",
            "burpengary",
            "narangba",
            "dakabin",
          ],
        },
        {
          north: {
            display: "East",
            zones: [],
          },
          south: {
            display: "City & South",
            zones: [4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18],
          },
          order: 1,
          stations: [
            "kallangur",
            "murrumba downs",
            "mango hill",
            "mango hill east",
            "rothwell",
            "kippa-ring",
          ],
        },
        {
          north: {
            display: "North & East",
            zones: [0, 1, 2, 3],
          },
          south: {
            display: "City & South",
            zones: [5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18],
          },
          order: 0,
          stations: [
            "petrie",
            "lawnton",
            "bray park",
            "strathpine",
            "bald hills",
            "carseldine",
            "zillmere",
            "geebung",
            "sunshine",
            "virginia",
          ],
        },
        {
          north: {
            display: "East",
            zones: [],
          },
          south: {
            display: "City & South",
            zones: [6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18],
          },
          order: 0,
          stations: [
            "bindha",
            "banyo",
            "nudgee",
            "boondall",
            "north boondall",
            "deagon",
            "sandgate",
            "shorncliffe",
          ],
        },
        {
          north: {
            display: "North & East",
            zones: [0, 1, 2, 3, 4, 5],
          },
          south: {
            display: "City & South",
            zones: [7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18],
          },
          order: 0,
          stations: ["northgate", "nundah", "toombul"],
        },
        {
          north: {
            display: "North",
            zones: [],
          },
          south: {
            display: "City & South",
            zones: [8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18],
          },
          order: 1,
          stations: ["international airport", "domestic airport"],
        },
        {
          north: {
            display: "East",
            zones: [0, 1, 2, 3, 4, 5, 6, 7],
          },
          south: {
            display: "City & South",
            zones: [9, 10, 11, 12, 13, 14, 15, 16, 17, 18],
          },
          order: 1,
          stations: ["clayfield", "hendra", "ascot", "doomben"],
        },
        {
          north: {
            display: "North & East",
            zones: [0, 1, 2, 3, 4, 5, 6, 7, 8],
          },
          south: {
            display: "City & South",
            zones: [10, 11, 12, 13, 14, 15, 16, 17, 18],
          },
          order: 0,
          stations: ["eagle junction", "wooloowin", "albion"],
        },
        {
          north: {
            display: "North",
            zones: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9],
          },
          south: {
            display: "City & South",
            zones: [11, 12, 13, 14, 15, 16, 17, 18],
          },
          order: 0,
          stations: [
            "ferny grove",
            "keperra",
            "grovely",
            "oxford park",
            "michleton",
            "gaythorne",
            "enoggera",
            "alderley",
            "newmarket",
            "wilston",
          ],
        },
        {
          north: {
            display: "North & East",
            zones: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
          },
          south: {
            display: "City & South/West",
            zones: [12, 13, 14, 15, 16, 17, 18],
          },
          order: 0,
          stations: [
            "bowen hills",
            "fortitude valley",
            "central",
            "roma street",
            "exhibition",
          ],
        },
        {
          north: {
            display: "City & North",
            zones: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11],
          },
          south: {
            display: "South & East",
            zones: [13, 14, 15, 16, 17, 18],
          },
          order: 0,
          stations: [
            "south brisbane",
            "south bank",
            "boggo rd",
            "park rd",
            "boggo rd/park rd",
            "boggo rd / park rd",
            "boggo road",
            "park road",
            "boggo road/park road",
            "boggo road / park road",
          ],
        },
        {
          north: {
            display: "City & North",
            zones: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12],
          },
          south: {
            display: "West",
            zones: [14, 15, 16, 17, 18],
          },
          order: 0,
          stations: [
            "milton",
            "auchenflower",
            "toowong",
            "taringa",
            "indooroopilly",
            "chelmer",
            "graceville",
            "sherwood",
            "corinda",
            "oxley",
            "darra",
          ],
        },
        {
          north: {
            display: "City & North",
            zones: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13],
          },
          south: {
            display: "South",
            zones: [15, 16, 17, 18],
          },
          order: 0,
          stations: [
            "buranda",
            "coorparoo",
            "norman park",
            "morningside",
            "cannon hill",
            "murarrie",
            "hemmant",
            "lindum",
            "wynnum north",
            "wynnum",
            "wynnum central",
            "manly",
            "lota",
            "thorneside",
            "birkdale",
            "wellington point",
            "ormiston",
            "cleveland",
          ],
        },
        {
          north: {
            display: "City & North",
            zones: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13],
          },
          south: {
            display: "South",
            zones: [16, 17, 18],
          },
          order: 0,
          stations: [
            "dutton park",
            "fairfield",
            "yeronga",
            "moorooka",
            "rocklea",
            "coopers plains",
            "banoon",
            "sunnybank",
            "altandi",
            "runcorn",
            "fruitgrove",
            "kuraby",
            "trinder park",
            "woodridge",
            "kingston",
            "loganlea",
            "bethania",
            "edens landing",
            "holmview",
            "beenleigh",
          ],
        },
        {
          north: {
            display: "City & North",
            zones: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13],
          },
          south: {
            display: "South",
            zones: [15, 18],
          },
          order: 0,
          stations: ["richlands", "springfield", "springfield central"],
        },
        {
          north: {
            display: "City & North",
            zones: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13],
          },
          south: {
            display: "South",
            zones: [15, 18],
          },
          order: 0,
          stations: [
            "wacol",
            "gailes",
            "goodna",
            "redbank",
            "riverview",
            "dinmore",
            "ebbw vale",
            "bundamba",
            "booval",
            "east ipswich",
            "ipswich",
            "thomas street",
            "wulkuraka",
            "karrabin",
            "walloon",
            "thagoona",
            "rosewood",
          ],
        },
        {
          north: {
            display: "City & North",
            zones: [
              0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18,
            ],
          },
          south: {
            display: "South",
            zones: [],
          },
          order: 0,
          stations: [
            "ormeau",
            "pimpama",
            "coomera",
            "hope island",
            "nerang",
            "merrimac",
            "robina",
            "varsity lakes",
          ],
        },
      ];
      let innerInnerCity = [
        "bowen hills",
        "fortitude valley",
        "central",
        "roma street",
        "exhibition",
        "south brisbane",
        "south bank",
        "boggo rd",
        "park rd",
        "boggo rd/park rd",
        "boggo rd / park rd",
        "boggo road",
        "park road",
        "boggo road/park road",
        "boggo road / park road",
      ];
      let innerCity = {
        colour: "#c7c8ca",
        stations: [
          "northgate",
          "nundah",
          "toombul",
          "eagle junction",
          "wooloowin",
          "albion",
          ...innerInnerCity
        ],
      };
      let nameOverrides = {
        "Kippa-Ring": "Redcliffe",
        "Varsity Lakes": "Gold Coast",
      };

      function takeshot() {
        const element = document.querySelector(".container");

        // Use html2canvas to take a screenshot
        html2canvas(element).then((canvas) => {
          // Convert the canvas to a data URL
          const dataURL = canvas.toDataURL("image/png");

          // Create a temporary link to download the image
          const link = document.createElement("a");
          link.href = dataURL;
          link.download = "screenshot.png";
          link.click();
        });
      }
      function car3(num, setTo = null) {
        let pel = document.querySelector("#tr" + num);
        let mkel = document.querySelector("#tcar" + num);
        let ngr = pel.querySelectorAll("td")[4].querySelector(".ngr");
        let tcar = pel.querySelectorAll("td")[4].querySelector(".tcar");
        if ((ngr.style.display == "" && setTo == null) || setTo == "0") {
          ngr.style.display = "none";
          tcar.style.display = "";
          mkel.innerText = "NGR #" + num;
        } else {
          ngr.style.display = "";
          tcar.style.display = "none";
          mkel.innerText = "3car #" + num;
        }
      }
      function hide(num, setTo = null) {
        let el = document.querySelector("#tr" + num);
        if (el.classList.contains("hidden")) el.classList.remove("hidden");
        if (setTo != null) {
          el.style.opacity = setTo;
          if (setTo == "1") {
            document.querySelector("#hide" + num).innerText = "Hide #" + num;
            el.querySelectorAll("[contenteditable=false]").forEach((v) =>
              v.setAttribute("contenteditable", "true")
            );
          } else {
            document.querySelector("#hide" + num).innerText = "Show #" + num;
            el.classList.add("hidden");
            el.querySelectorAll("[contenteditable=true]").forEach((v) =>
              v.setAttribute("contenteditable", "false")
            );
          }
          return;
        }
        if (el.style.opacity == "") el.style.opacity = "1";
        document.querySelector("#hide" + num).innerText =
          el.style.opacity == "1" ? "Show #" + num : "Hide #" + num;
        if (el.style.opacity == "1") {
          el.classList.add("hidden");
          el.querySelectorAll("[contenteditable=true]").forEach((v) =>
            v.setAttribute("contenteditable", "false")
          );
        } else {
          el.querySelectorAll("[contenteditable=false]").forEach((v) =>
            v.setAttribute("contenteditable", "true")
          );
        }
        el.style.opacity = el.style.opacity == "1" ? "0" : "1";
      }
      function setColor(i, val) {
        document.querySelector("#colsel" + i).value = val;
        document.querySelector("#tr" + i).style.backgroundColor = val;
      }
      for (let i = 1; i <= 6; i++) {
        document.querySelector("#colsel" + i).onchange = () => {
          let val = document.querySelector("#colsel" + i).value;
          document.querySelector("#tr" + i).style.backgroundColor = val;
        };
      }

      let ctrl = false;
      document.onkeydown = (ev) => {
        if (ev.key == "Control") ctrl = true;
      };
      document.onkeyup = (ev) => {
        if (ev.key == "Control") ctrl = false;
      };

      document.querySelectorAll(".active").forEach((el) => {
        el.onclick = (e) => {
          if (el.parentElement.style.opacity == "0") return;
          if (ctrl) return;
          if (
            e.target != el &&
            (e.target.classList.contains("active") ||
              e.target.classList.contains("inactive") ||
              e.target.classList.contains("ignore"))
          )
            return;
          if (el.classList.contains("active")) {
            el.classList.remove("active");
            el.classList.add("inactive");
            if (el.hasAttribute("contenteditable"))
              el.setAttribute("contenteditable", "false");
          } else {
            el.classList.remove("inactive");
            el.classList.add("active");
            if (el.hasAttribute("contenteditable"))
              el.setAttribute("contenteditable", "true");
          }
        };
      });

      function getZone(st) {
        st = st.toLowerCase().replace("station", "").trim();
        for (let i = 0; i < zones.length; i++) {
          if (zones[i].stations.includes(st)) return i;
        }
        return -1;
      }

      async function main() {
        let res = await fetch(
          "https://corsproxy.io/?url=" +
            encodeURIComponent(
              "https://anytrip.com.au/api/v3/region/au4/stops?limit=500&maxLat=-26.39899568258307&maxLon=153.7892943671533&minLat=-28.226719490511584&minLon=152.33085930855955&modes=au4:trains"
            )
        );
        let stations = await res.json();
        window.stations = stations;

        let sList = document.querySelector("#station-list");

        let nameToID = {};

        async function _updateStation(
          id,
          thisStation,
          filterfunc = (v) => {
            return true;
          },
          display = "Next Inbound and Outbound Trains"
        ) {
          let res = await fetch(
            "https://corsproxy.io/?url=" +
              encodeURIComponent(
                "https://anytrip.com.au/api/v3/region/au4/departures/" +
                  encodeURIComponent(id) +
                  "?limit=250&modes=au4:trains"
              )
          );
          let js = await res.json();
          window.station = js;

          let now = new Date();
          let time = now.getTime();

          js.response.departures = js.response.departures
            .filter((v) => v.tripInstance.trip.route.mode == "au4:trains")
            .filter((v) => v.stopTimeInstance.departure.time - time / 1000 > 0)
            .filter(filterfunc)
            .sort(
              (a, b) =>
                a.stopTimeInstance.departure.time -
                b.stopTimeInstance.departure.time
            );
          let len = Math.min(js.response.departures.length, 6);
          for (let i = 6; i > len; i--) {
            hide(i, "0");
          }
          for (let i = 1; i <= len; i++) {
            hide(i, "1");
          }

          document.querySelector(".lmrmiddle").innerText = display;

          let nowh = ((now.getHours() - 1) % 12) + 1;
          let nowm = now.getMinutes().toString();
          let nows = now.getSeconds().toString();

          while (nowm.length < 2) nowm = "0" + nowm;
          while (nows.length < 2) nows = "0" + nows;

          document.querySelector(".time").innerText = `${nowh}:${nowm}:${nows}`;

          for (let i = 1; i <= len; i++) {
            let dep = js.response.departures[i - 1];
            let plt = dep.stopTimeInstance.stop.disassembled.platformName;
            let det = dep.stopTimeInstance.departure.time;
            let deldet = det;
            if (dep.stopTimeInstance.departure.delay != undefined)
              deldet -= dep.stopTimeInstance.departure.delay;
            let dest = dep.tripInstance.trip.headsign.headline
              .trim()
              .replace(/ station$/, "")
              .trim();
            if (nameOverrides[dest] != undefined) dest = nameOverrides[dest];
            let color = "#" + dep.tripInstance.trip.route.color;
            let isNGR =
              dep.vehicle.vehicleModel != undefined &&
              dep.vehicle.vehicleModel.includes("NGR");

            let _d = new Date();
            let stopsRes = await fetch(
              "https://corsproxy.io/?url=" +
                encodeURIComponent(
                  "https://anytrip.com.au/api/v3/region/au4/" +
                    dep.tripInstance._path
                )
            );
            let stops = (await stopsRes.json()).response;
            let upTo = stops.realtimePattern.filter(
              (v) => v.stop.parent.id == id
            )[0].index;
            let isCity = false;
            if (
              innerCity.stations.includes(
                stops.realtimePattern[
                  stops.realtimePattern.length - 1
                ].stop.parent.fullName
                  .toLowerCase()
                  .replace("station", "")
                  .trim()
              )
            )
              color = innerCity.colour;
            if (
              !innerInnerCity.includes(
                thisStation.toLowerCase().replace(" station", "").trim()
              )
            ) {
              for (let i = upTo + 1; i < stops.realtimePattern.length; i++) {
                let { stop } = stops.realtimePattern[i];
                if (
                  innerCity.stations.includes(
                    stop.parent.fullName
                      .toLowerCase()
                      .replace("station", "")
                      .trim()
                  )
                ) {
                  dest = "City & " + dest;
                  break;
                }
              }
            }

            setColor(i, color);
            let td = (v) =>
              document.querySelector("#tr" + i).querySelectorAll("td")[v];
            td(1).innerText = dest;
            if (td(2).classList.contains("active"))
              td(2).classList.remove("active");
            td(2).classList.add("inactive");
            td(2).setAttribute("contenteditable", "false");
            td(3).innerText = plt;
            if (isNGR) {
              if (td(4).classList.contains("inactive"))
                td(4).classList.remove("inactive");
              td(4).classList.add("active");
            } else {
              if (td(4).classList.contains("active"))
                td(4).classList.remove("active");
              td(4).classList.add("inactive");
            }

            let deth = ((new Date(deldet * 1000).getHours() - 1) % 12) + 1;
            let detm = new Date(deldet * 1000).getMinutes().toString();
            while (detm.length < 2) detm = "0" + detm;
            td(0).innerText = `${deth}:${detm}`;
            let estdepmin = Math.floor((det - time / 1000) / 60) % 60;
            let estdeph = Math.floor(Math.floor((det - time / 1000) / 60) / 60);
            td(5).innerText =
              estdeph == 0
                ? estdepmin + " min"
                // : `${estdeph}:${estdepmin < 10 ? "0" : ""}${estdepmin}`;
                : `${deth}:${detm}`;
            // console.log(dep);
          }
        }

        window.updateStationSW = async () => {
          let el = document.querySelector(".select-station input");
          let id = nameToID[el.value];
          let zoneSt = getZone(el.value);
          console.log(zoneSt);

          _updateStation(
            id,
            el.value,
            (v) => {
              let dest = v.tripInstance.trip.headsign.headline;
              let destZone = getZone(dest);
              if (zoneSt == destZone) {
                let cel = el.value.toLowerCase().replace("station", "").trim();
                let del = dest.toLowerCase().replace("station", "").trim();
                if (
                  zones[zoneSt].order == 0 &&
                  zones[zoneSt].stations.findIndex((s) => s == cel) <
                    zones[zoneSt].stations.findIndex((s) => s == del)
                )
                  return true;
                if (
                  zones[zoneSt].order == 1 &&
                  zones[zoneSt].stations.findIndex((s) => s == cel) >
                    zones[zoneSt].stations.findIndex((s) => s == del)
                )
                  return true;
              }
              return zones[zoneSt].south.zones.includes(destZone);
            },
            "Next (1-6) Trains " +
              (id == "au4:place_romsta"
                ? "South & West"
                : zones[zoneSt].south.display)
          );
        };
        window.updateStationNE = async () => {
          let el = document.querySelector(".select-station input");
          let id = nameToID[el.value];
          let res = await fetch(
            "https://corsproxy.io/?url=" +
              encodeURIComponent(
                "https://anytrip.com.au/api/v3/region/au4/departures/" +
                  encodeURIComponent(id) +
                  "?limit=250"
              )
          );

          let zoneSt = getZone(el.value);
          console.log(zoneSt);
          _updateStation(
            id,
            el.value,
            (v) => {
              let dest = v.tripInstance.trip.headsign.headline;
              let destZone = getZone(dest);
              if (zoneSt == destZone) {
                let cel = el.value.toLowerCase().replace("station", "").trim();
                let del = dest.toLowerCase().replace("station", "").trim();
                if (
                  zones[zoneSt].order == 0 &&
                  zones[zoneSt].stations.findIndex((s) => s == cel) >
                    zones[zoneSt].stations.findIndex((s) => s == del)
                )
                  return true;
                if (
                  zones[zoneSt].order == 1 &&
                  zones[zoneSt].stations.findIndex((s) => s == cel) <
                    zones[zoneSt].stations.findIndex((s) => s == del)
                )
                  return true;
              }
              return zones[zoneSt].north.zones.includes(destZone);
            },
            "Next (1-6) Trains " + zones[zoneSt].north.display
          );
        };
        window.updateStationAll = async () => {
          let el = document.querySelector(".select-station input");
          let id = nameToID[el.value];
          _updateStation(id, el.value);
        };

        stations.response.stops.forEach((s) => {
          let option = document.createElement("option");
          option.value = s.stop.fullName;
          option.innerText = s.stop.fullName;
          nameToID[s.stop.fullName] = s.stop.id;
          sList.appendChild(option);
        });

        document
          .querySelector(".select-station input")
          .setAttribute("placeholder", "Select your station...");

        if (window.location.hash.replace("#", "").trim() != "") {
          document
            .querySelectorAll(".hide")
            .forEach((el) => (el.style.display = "none"));
          document.querySelector(".select-station input").value =
            decodeURIComponent(location.hash.replace("#", ""));
          // window.updateStationAll();
          // window.updateStationSW();
          window.updateStationNE();
        }
      }
      main();
    </script>
  </body>
</html>
